
{% spaceless %}

{# Parameters:
  - breakpoint (string) (default: 'md')
    options: ['', 'xs', 'sm', 'md', 'lg', 'xl']
  - brand (object) (default: {})
    format: {
      src: '',
      alt: '',
      motto: '', (optional)
      link: ''
    }
  - collapse_id (string) (default: '')
  - list_id (string) (default: '')
  - items (array of objects) (default: [{}])
    format: [{
      id: '',
      label: '',
      icon: '',
      links: (array of objects)
      format: [{
        link: '',
        label: '',
        extra_attributes: [] (example: ['class' => ['btn', 'btn-primary]])
        popover (object) (default: {})
        format: {
          title: '',
          description: '',
          cta (object) (default: {})
          format: {
            link: '',
            text: '',
            attributes: '', (optional)
          }
        }
      }]
    }]
#}

{% set _breakpoint = breakpoint|default('') %}
{% set _brand = brand|default({}) %}
{% set _collapse_id = collapse_id|default('') %}
{% set _list_id = list_id|default('') %}
{% set _items = items|default([{}]) %}

{% set _nav_classes = ['joinup-navbar', 'navbar', 'navbar-expand'] %}
{% set _navbar_toggler_classes = ['navbar-toggler'] %}
{% set _list_id = list_id|default('accordion-1') %}
{% set _list_classes = ['navbar-nav', 'accordion', 'accordion-flush'] %}
{% set _list_item_classes = ['nav-item', 'accordion-item'] %}

{% if _breakpoint %}
  {% set _list_item_classes = _list_item_classes|merge(['d-' ~ _breakpoint ~ '-none']) %}
{% endif %}

{% if nav_attributes is empty %}
  {% set nav_attributes = create_attribute() %}
{% endif %}

{% if navbar_toggler_attributes is empty %}
  {% set navbar_toggler_attributes = create_attribute() %}
{% endif %}

{% if list_attributes is empty %}
  {% set list_attributes = create_attribute() %}
{% endif %}

{% if list_item_attributes is empty %}
  {% set list_item_attributes = create_attribute() %}
{% endif %}

{% set nav_attributes = nav_attributes.addClass(_nav_classes) %}
{% set navbar_toggler_attributes = navbar_toggler_attributes.addClass(_navbar_toggler_classes) %}
{% set navbar_toggler_attributes = navbar_toggler_attributes.setAttribute('type', 'button') %}
{% set navbar_toggler_attributes = navbar_toggler_attributes.setAttribute('data-bs-toggle', 'collapse') %}
{% set navbar_toggler_attributes = navbar_toggler_attributes.setAttribute('data-bs-target', '#' ~ _collapse_id) %}
{% set navbar_toggler_attributes = navbar_toggler_attributes.setAttribute('aria-controls', _collapse_id) %}
{% set navbar_toggler_attributes = navbar_toggler_attributes.setAttribute('aria-expanded', 'false') %}
{% set navbar_toggler_attributes = navbar_toggler_attributes.setAttribute('aria-label', 'Toggle navigation') %}
{% set list_attributes = list_attributes.addClass(_list_classes) %}
{% set list_attributes = list_attributes.setAttribute('id', _list_id) %}
{% set list_item_attributes = list_item_attributes.addClass(_list_item_classes) %}

<nav
  {{ nav_attributes }}
>
  <div class="container">
    <a class="navbar-brand" href="{{ _brand.link }}">
      <img class="navbar-brand-image" src="{{ _brand.src }}" alt="{{ _brand.alt }}" />
    </a>
    {% if _brand.motto is not empty %}
      <span class="navbar-motto d-none d-md-block">{{ _brand.motto }}</span>
    {% endif %}

    <div class="collapse navbar-collapse rounded-bottom" id="{{ _collapse_id }}">
      <ul
        {{ list_attributes }}
      >
        {% for item in _items %}
          {% if _breakpoint %}
            {% for link in item.links %}
              <li class="nav-item d-none d-{{ _breakpoint }}-inline-flex">
                {% if link.link %}
                  <a class="nav-link" href="{{ link.link }}" {{ anchor.extra_attributes }}>{{ link.label }}</a>  
                {% elseif link.popover %}
                  <button
                    data-bs-toggle="popover"
                    autocomplete="off"
                    data-bs-trigger="click"
                    data-bs-placement="bottom"
                    data-bs-content="<p class='popover__title'>{{ link.popover.title }}</p><p class='popover__description'>{{ link.popover.description }}</p><a class='popover__cta' href='{{ link.popover.cta.link }}' {{ link.popover.cta.attributes }}>{{ link.popover.cta.text }}</a>"
                    data-bs-custom-class="navbar__popover"
                    data-bs-html="true"
                    data-bs-container=".nav-item"
                    data-bs-offset="-98, 1"
                    title=""
                    class="popover-trigger popover-getstarted--lg"
                    type="button"
                  >
                    {{ link.label }}
                  </button>
                {% endif %}
              </li>
            {% endfor %}
          {% endif %}
          <li {{ list_item_attributes }}>
            <span class="accordion-header" id="heading-{{ item.id }}">
              <button
                class="accordion-button nav-link"
                data-bs-toggle="collapse"
                autocomplete="off"
                data-bs-target="#collapse-{{ item.id }}"
                aria-controls="collapse-{{ item.id }}"
                aria-expanded="false"
                type="button"
              >
                {% if item.icon is not empty %}
                  <svg class="bi icon--s">
                    <use xlink:href="{{ base_path ~ directory }}/assets/icons/bootstrap-icons.svg#{{ item.icon.name }}"></use>
                  </svg>
                {% endif %}
                {% if item.label is not empty %}
                  <span class="accordion-button-label">{{ item.label }}</span>
                {% endif %}
              </button>
            </span>
            <div
              id="collapse-{{ item.id }}"
              class="accordion-collapse collapse rounded-bottom"
              aria-labelledby="heading-{{ item.id }}"
              data-bs-parent="#{{ _collapse_id }}"
            >
              <div class="accordion-body">
                <ul class="accordion-list">
                  {% for link in item.links %}
                    <li class="accordion-list-item">
                      {% if link.link %}
                        <a href="{{ link.link }}" class="accordion-list-link">
                          {{ link.label }}
                        </a>
                      {% elseif link.popover %}
                        <button
                          data-bs-toggle="popover"
                          autocomplete="off"
                          data-bs-trigger="click"
                          data-bs-placement="bottom"
                          data-bs-content="<p class='popover__title'>{{ link.popover.title }}</p><p class='popover__description'>{{ link.popover.description }}</p><a class='popover__cta' href='{{ link.popover.cta.link }}' {{ link.popover.cta.attributes }}>{{ link.popover.cta.text }}</a>"
                          data-bs-custom-class="navbar__popover"
                          data-bs-html="true"
                          data-bs-container=".accordion-list-item"
                          data-bs-offset="64, -2"
                          title=""
                          class="popover-trigger popover-getstarted--sm"
                          type="button"
                        >
                          {{ link.label }}
                        </button>
                      {% endif %}
                    </li>
                  {% endfor %}
                </ul>
              </div>
            </div>
          </li>
        {% endfor %}
      </ul>
    </div>
  </div>
</nav>

{% endspaceless %}
