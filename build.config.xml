<?xml version="1.0" encoding="UTF-8" ?>

<project name="Config management" default="help">

    <target name="setup-config-exclude" depends="writable-settings-folder, writable-settings-local-php">
        <!-- Remove previous configuration. -->
        <reflexive>
            <fileset dir="${website.settings.dir}">
                <include pattern="settings.local.php" />
            </fileset>
            <filterchain>
                <replaceregexp>
                    <regexp
                        pattern="^\s*\$settings\s*\[\s*('config_exclude_modules'|\&quot;config_exclude_modules\&quot;)\s*\].*$\n"
                        replace=""
                        modifiers="m" />
                </replaceregexp>
            </filterchain>
        </reflexive>

        <!-- Rebuild the settings. -->
        <php expression="'[&quot;' . implode('&quot;, &quot;', preg_split('/\s+/', trim('${drupal.modules.dev}'))) . '&quot;]'" returnProperty="modules.dev"/>
        <append destFile="${website.settings.local.php}" text="$settings['config_exclude_modules'] = ${modules.dev};${line.separator}"/>
    </target>

</project>
